<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Pedido #{{ pedido.id }} | BarberShop</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/detalles_pedido.css') }}"
    />
  </head>

  <body class="bg-barber">
    <div class="container py-5">
      <a href="/mis_pedidos" class="btn btn-volver mb-4">
        <i class="bi bi-arrow-left"></i> Volver a mis pedidos
      </a>

      <h2 class="text-center title-neon mb-4">Pedido #{{ pedido.id }}</h2>

      <div class="glass-card pedido-info p-4 mb-4 text-light">
        <!-- CLIENTE -->
        <p>
          <strong>Cliente:</strong>
          {{ pedido.cliente_nombre if pedido.cliente_nombre else "No disponible"
          }}
        </p>

        <p><strong>Fecha:</strong> {{ pedido.fecha }}</p>

        <!-- ESTADO -->
        <p>
          <strong>Estado:</strong>
          {% if pedido.estado == "pendiente" %}
          <span class="badge bg-warning text-dark">Pendiente</span>
          {% elif pedido.estado == "encamino" %}
          <span class="badge bg-info text-dark">En camino</span>
          {% elif pedido.estado == "entregado" %}
          <span class="badge bg-success">Entregado</span>
          {% else %}
          <span class="badge bg-secondary">{{ pedido.estado }}</span>
          {% endif %}
        </p>

        <!-- DIRECCIÓN (CORREGIDO) -->
        <p>
          <strong>Dirección:</strong>
          {{ pedido.direccion_envio if pedido.direccion_envio else "No
          registrada" }}
        </p>

        <!-- MÉTODO DE PAGO -->
        <p>
          <strong>Método de pago:</strong>
          {{ pedido.metodo_pago if pedido.metodo_pago else "No registrado" }}
        </p>
      </div>

      <!-- PRODUCTOS -->
      <h3 class="text-neon mb-3">Productos</h3>

      <div class="table-responsive">
        <table
          class="tabla-detalles table table-dark table-striped align-middle text-center"
        >
          <thead>
            <tr>
              <th>Imagen</th>
              <th>Producto</th>
              <th>Cantidad</th>
              <th>Precio</th>
              <th>Subtotal</th>
            </tr>
          </thead>
          <tbody>
            {% for d in detalles %}
            <tr>
              <td>
                <img
                  src="{{ url_for('static', filename='img/productos/' ~ d.producto_imagen) }}"
                  class="img-detalle"
                />
              </td>
              <td>{{ d.producto_nombre }}</td>
              <td>{{ d.cantidad }}</td>
              <td>$ {{ '%.2f'|format(d.precio) }}</td>
              <td>$ {{ '%.2f'|format(d.cantidad * d.precio) }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- TOTAL -->
      <h3 class="text-end text-neon mt-4">
        Total: $ {{ '%.2f'|format(pedido.total) }}
      </h3>

      <div class="text-end mt-3">
        <a href="/pedido/{{ pedido.id }}/pdf" class="btn btn-neon">
          <i class="bi bi-file-earmark-arrow-down"></i> Descargar PDF
        </a>
      </div>
    </div>
  </body>
</html>
