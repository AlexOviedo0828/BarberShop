<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Administración de Productos</title>

  <!-- BOOTSTRAP -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- ICONOS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- SWEETALERT -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_productos.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/usuario.css') }}" />
</head>

<body>

  <main class="contenido">

    <!-- HEADER ESTILO PANEL USUARIO -->
    <header class="glass-header d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="fw-bold mb-0">Administración de Productos</h2>
        <p class="mb-0">Gestiona los productos disponibles en la tienda.</p>
      </div>

      <div class="d-flex gap-3">

        <a href="/admin/productos/nuevo" class="btn btn-success me-2">
          <i class="bi bi-plus-circle me-1"></i> Nuevos Productos
        </a>

        <a href="/dashboard/admin" class="btn btn-outline-light">
          <i class="bi bi-arrow-left"></i> Volver
        </a>

        

      </div>
    </header>

    <!-- BUSCADOR DE PRODUCTOS -->
    <div class="search-bar-wrapper mb-4">
      <div class="search-bar-container shadow-lg">
        <i class="bi bi-search search-icon"></i>
        <input
          type="text"
          id="searchInput"
          class="search-input"
          placeholder="Buscar producto..."
          onkeyup="filtrarProductos()"
        />
      </div>
    </div>

    <!-- BANNER -->
    <div class="banner-wrapper mb-4">
      <div class="banner-container">
        <div id="carouselBanner" class="carousel slide" data-bs-ride="carousel">

          <div class="carousel-inner">
            <div class="carousel-item active">
              <img src="{{ url_for('static', filename='img/peluqueros/ban1.png') }}" class="banner-img" />
            </div>

            <div class="carousel-item">
              <img src="{{ url_for('static', filename='img/peluqueros/ban2.png') }}" class="banner-img" />
            </div>

            <div class="carousel-item">
              <img src="{{ url_for('static', filename='img/peluqueros/ban3.png') }}" class="banner-img" />
            </div>
          </div>

          <button class="carousel-control-prev" type="button" data-bs-target="#carouselBanner" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </button>

          <button class="carousel-control-next" type="button" data-bs-target="#carouselBanner" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
          </button>

        </div>
      </div>
    </div>

    <!-- LISTA DE PRODUCTOS -->
    <h3 class="catalog-title mb-4">Productos disponibles</h3>

    <div class="row g-4">

      {% for p in productos %}
      <div class="col-12 col-sm-6 col-md-4 col-xl-3">

        <div class="card product-card shadow-lg">

          <img
            src="{{ url_for('static', filename='img/productos/' ~ p.imagen) }}"
            class="product-img"
            alt="{{ p.nombre }}"
          />

          <div class="card-body text-center">

            <h5 class="product-name">{{ p.nombre }}</h5>
            <p class="product-price">$ {{ "%.2f"|format(p.precio) }}</p>

            <div class="d-flex justify-content-center gap-2 mt-2">
              <a href="/admin/productos/editar/{{ p.id }}" class="btn btn-primary btn-sm px-3">
                <i class="bi bi-pencil-square"></i>
              </a>

              <button class="btn btn-danger btn-sm px-3 btn-eliminar" data-id="{{ p.id }}">
                <i class="bi bi-trash"></i>
              </button>
            </div>

          </div>
        </div>

      </div>
      {% endfor %}

    </div>

  </main>

  <!-- SweetAlert DELETE -->
  <script>
    document.querySelectorAll(".btn-eliminar").forEach((btn) => {
      btn.addEventListener("click", function () {

        let id = this.dataset.id;

        Swal.fire({
          title: "¿Eliminar producto?",
          text: "Esta acción es irreversible.",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#d33",
          cancelButtonColor: "#3085d6",
          confirmButtonText: "Eliminar",
        }).then((result) => {
          if (result.isConfirmed) {
            fetch(`/admin/productos/eliminar/${id}`, { method: "POST" })
              .then((res) => res.json())
              .then(() => {
                Swal.fire("Eliminado", "Producto eliminado correctamente", "success")
                  .then(() => location.reload());
              });
          }
        });

      });
    });
  </script>

  <script src="{{ url_for('static', filename='js/admin_productos.js') }}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
